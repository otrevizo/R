---
title: "DPLYR Library Vignette"
date: '`r format(Sys.Date(), "%Y-%B-%d")`'
output:
  pdf_document:
    toc: yes
  html_document:
    toc: yes
---

# Purpose

This vignette aims to introduce you dplyr library. It is here for learning purposes.

- \{dplyr\} (pronounced d - plier dataset plier... pliers to trim data) 

# Libraries

- Load dpylr

Tip: Shortcut select a word and click quotations to automate.

It has several functions or methods

- Pipes %>% to chain commands



```{r setup, include=FALSE}

# This is the library we will highlight here
library(dplyr)

knitr::opts_chunk$set(echo = TRUE)
```


# Load possum dataset from DAAG

```{r}

# Add DAAG to pull some data
library(DAAG)


# For example DAAG has 'possum'

# data()

# From the console, you can do:
# > ?datasetname

data('possum')
str(possum)
summary(possum)
# Try from the console:
# > ?possum
```

## Pipes

- Mac shortcut shift-command-m for %>% (that is from {dyplr})
- To be demosntrated throughout this vignette

## SELECT

- To specific column, by column number or column 'name'


```{r}
# Select specific columns.
#
possum %>% select(2:3, 4:7)
```

## FILTER

```{r}
# This example shows a filter with multiple conditions.
#
possum %>% filter(sex == 'f', Pop == 'Vic', age < 4)
```

## ARRANGE

- A type of sort

```{r}
# Arrange, or sort
# Here we start to pipe using multiple lines.
#
possum %>% filter(sex == 'f', Pop == 'Vic', age < 4) %>% 
  arrange(desc(belly))

```

## SUMMARISE

- You can introduce functions or equations and summarise.

```{r}
# summarise() with multple functions... Avg, SD...
#
possum %>% filter(sex == 'f', Pop == 'Vic', age < 4) %>% 
  arrange(desc(belly)) %>% 
  summarise(Avg = mean(belly),
            SD = sd(belly),
            count = n())

```

## GROUP BY

- It creates a table.

```{r}
# group_by() before summarising.
#
possum %>% filter(sex == 'm') %>% 
  group_by(site) %>%
  summarise(Avg = mean(belly),
            SD = sd(belly),
            count = n())


```

## Example: arrange() on that table created by group_by()

```{r}
# Add another function, descending order
possum %>% filter(sex == 'm') %>% 
  group_by(site) %>%
  summarise(Avg = mean(belly),
            SD = sd(belly),
            count = n()) %>%
  arrange(desc(Avg))



```

## Create a new table (mutate)

```{r}
# New variable TR
mytable <- possum %>% 
  group_by(site) %>%
  summarise(TR = sum(taill) / sum(totlngth),
            count = n()) %>%
  arrange(desc(TR))

print(mytable)

```


## Join

From _dplyr_ documentation:

mutate-joins {dplyr}	R Documentation

Mutating joins

Description

Mutating joins add columns from y to x, matching observations based on the keys. There are four mutating joins: the inner join, and the three outer joins.

Inner join: An inner_join() only keeps observations from x that have a matching key in y.

The most important property of an inner join is that unmatched rows in either input are not included in the result. This means that generally inner joins are not appropriate in most analyses, because it is too easy to lose observations.

Outer joins: The three outer joins keep observations that appear in at least one of the data frames:

A left_join() keeps all observations in x.

A right_join() keeps all observations in y.

A full_join() keeps all observations in x and y.

### Example 1

```{r}
# Let's do an example
students_math <- c('mary', 'john', 'paul', 'jane', 'peter')
math <- c('A', 'A', 'B', 'C', 'B')

students_english <- c('tom', 'mary', 'john', 'paul')
english <- c('C', 'B', 'C', 'A')

dfa <- data.frame(students_math, math)
dfb <- data.frame(students_english, english)

colnames(dfa) <- c('students', 'math')
colnames(dfb) <- c('students', 'english')

left <- dfa %>% left_join(dfb)
right <- dfa %>% right_join(dfb)
inner <- dfa %>% inner_join(dfb)
```


### Example 2

Joining based on two columns

```{r}
# Let's do an example
semester_math <- c('fall', 'fall', 'fall', 'fall', 'fall', 'spring', 'spring', 'spring', 'spring', 'spring')
students_math <- c('mary', 'john', 'paul', 'jane', 'peter', 'mary', 'john', 'paul', 'jane', 'peter')
math <- c('A', 'A', 'B', 'C', 'A', 'B', 'B', 'A', 'B', 'B')

semester_english <- c('fall', 'fall', 'fall', 'fall', 'spring', 'spring', 'spring', 'spring')
students_english <- c('tom', 'mary', 'john', 'paul', 'tom', 'mary', 'john', 'paul')
english <- c('C', 'B', 'C', 'A', 'B', 'B', 'B', 'A')

dfa <- data.frame(semester_math, students_math, math)
dfb <- data.frame(semester_english, students_english, english)

colnames(dfa) <- c('semester', 'students', 'math')
colnames(dfb) <- c('semester', 'students', 'english')

left <- dfa %>% left_join(dfb)
right <- dfa %>% right_join(dfb)
inner <- dfa %>% inner_join(dfb)
```

## Relocate: Move columns around

```{r}
# # https://dplyr.tidyverse.org/reference/relocate.html
# df <- df %>% dplyr::relocate(column_x, column_y, vector_of_columns)

```

# References

Dr. Bharatendra https://www.youtube.com/watch?v=rsfV57N7Uns&list=PL34t5iLfZddtUUABMikey6NtL05hPAp42&index=10

